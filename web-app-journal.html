<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-04-12 Sun 15:07 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Being a Journal of my Java Web-App Development Journey</title>
<meta name="generator" content="Org mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Mono:400,400i,600,600i|IBM+Plex+Sans:400,400i,600,600i|IBM+Plex+Serif:400,400i,600,600i">
<link rel="stylesheet" type="text/css" href="org-mode.css" />
<style type="text/css">
/* BODY { background: black; color: white; } */
ol.lower-alpha { list-style-type: lower-alpha; }
.open-question { background: rgba( 255, 0, 255, 0.3); }
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="."> UP </a>
 |
 <a accesskey="H" href="/index.html"> HOME </a>
</div><div id="content">
<h1 class="title">Being a Journal of my Java Web-App Development Journey</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orga11ed1b">1. Overview</a></li>
<li><a href="#org16a41b2">2. Java</a>
<ul>
<li><a href="#org5258471">2.1. On a Mac</a></li>
<li><a href="#org57c2854">2.2. Java EE</a>
<ul>
<li><a href="#jakarta-java-version-question">2.2.1. Question: Does Jakarta EE support any version of Java &gt;= 8?  Answer: apparently not. :(</a></li>
</ul>
</li>
<li><a href="#org98bcbb5">2.3. Editing in emacs</a></li>
</ul>
</li>
<li><a href="#org5381830">3. Tomcat</a>
<ul>
<li><a href="#orgebcf494">3.1. On a Mac</a></li>
<li><a href="#orga5d4f4a">3.2. On Ubuntu Linux 16.04</a></li>
<li><a href="#org6473f99">3.3. Deploy code</a></li>
<li><a href="#tomcat-jndi-resources">3.4. <span class="todo IN_PROGRESS">IN-PROGRESS</span> JDBC connection and other external configs preserved between version upgrade</a></li>
</ul>
</li>
<li><a href="#org0d29df6">4. Database</a>
<ul>
<li><a href="#org1096c0b">4.1. Consider an ORM of some sort</a></li>
<li><a href="#orgdb65424">4.2. SQLite</a>
<ul>
<li><a href="#orgda84e41">4.2.1. How much does it scale?</a></li>
</ul>
</li>
<li><a href="#org8682258">4.3. Postgresql</a></li>
<li><a href="#org82c0827">4.4. Apache Derby</a></li>
</ul>
</li>
<li><a href="#org4d907b5">5. JavaEE</a>
<ul>
<li><a href="#org2425ed6">5.1. Dependencies</a></li>
<li><a href="#org0bee24e">5.2. JavaEE (JakartaEE) specs</a></li>
<li><a href="#org3794fb5">5.3. JavaEE tutorial</a></li>
</ul>
</li>
<li><a href="#orgea998d0">6. JS Framework</a></li>
<li><a href="#orgcf6cd5d">7. Build system</a>
<ul>
<li><a href="#org20cc3c3">7.1. Gradle</a></li>
<li><a href="#maven">7.2. <span class="done RESEARCH_DONE">RESEARCH-DONE</span> Maven</a>
<ul>
<li><a href="#org04665b9">7.2.1. Install/update</a></li>
<li><a href="#orgeb9fa89">7.2.2. <span class="done RESEARCH_DONE">RESEARCH-DONE</span> Make a project</a>
<ul>
<li><a href="#org4d03ce7">7.2.2.1. Effective POM</a></li>
<li><a href="#orga56250c">7.2.2.2. Patching up generated POMs</a></li>
<li><a href="#orgd175865">7.2.2.3. How to define servlets (where the source code goes)</a></li>
<li><a href="#how-to-make-javax-servlet-dependencies-available">7.2.2.4. How to make <code>javax.servlet</code> dependencies available</a></li>
<li><a href="#j2ee-project-structure">7.2.2.5. File structure for "simple J2EE" (ha)</a></li>
<li><a href="#org0c6a647">7.2.2.6. Further info on the "simple" J2EE packaging, from reference docs</a></li>
</ul>
</li>
<li><a href="#orgf97d2b3">7.2.3. Reactor?  What's that?</a></li>
<li><a href="#org3603277">7.2.4. Useful sites</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgfd8b220">8. App code</a>
<ul>
<li><a href="#hello-world">8.1. Simplest possible code</a></li>
<li><a href="#org2eeb9b0">8.2. Other aspects to consider</a>
<ul>
<li><a href="#servlet-routing">8.2.1. Servlet Routing</a></li>
<li><a href="#org814ada6">8.2.2. JSON output</a></li>
<li><a href="#org07e9e2c">8.2.3. <span class="done DONE">DONE</span> Dependency Injection</a>
<ul>
<li><a href="#org9ac5dc6">8.2.3.1. Setup</a>
<ul>
<li><a href="#org0f58461">8.2.3.1.1. <span class="done DONE">DONE</span> Creating injected beans in another module</a>
<ul>
<li><a href="#org6a47b08">8.2.3.1.1.1. <span class="todo TODO">TODO</span> Bean scoping</a></li>
<li><a href="#orgc02ad0e">8.2.3.1.1.2. <span class="todo TODO">TODO</span> <code>beans.xml</code> is optional, supposedly</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org0933105">8.2.3.2. Background info</a></li>
</ul>
</li>
<li><a href="#org3a0e730">8.2.4. <span class="todo IN_PROGRESS">IN-PROGRESS</span> Persistence</a>
<ul>
<li><a href="#org4ae819e">8.2.4.1. <span class="done DONE">DONE</span> SQLite (for now)</a>
<ul>
<li><a href="#orgd81a2eb">8.2.4.1.1. <span class="done DONE">DONE</span> Create a play sqlite database</a>
<ul>
<li><a href="#org08f7419">8.2.4.1.1.1. <span class="todo TODO">TODO</span> Where to put it?</a></li>
<li><a href="#org44928fe">8.2.4.1.1.2. <span class="done DONE">DONE</span> jar properties</a></li>
<li><a href="#command-line-properties">8.2.4.1.1.3. <span class="todo IN_PROGRESS">IN-PROGRESS</span> Command-line (or otherwise run-time) properties</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orga81dbf9">8.2.4.2. Connect to SQLite d/b using JDBC</a>
<ul>
<li><a href="#org4bd68f6">8.2.4.2.1. <span class="todo IN_PROGRESS">IN-PROGRESS</span> sqlite driver</a></li>
</ul>
</li>
<li><a href="#orgdcfcef6">8.2.4.3. <span class="done HOLD">HOLD</span> Java Persistence API (JPA)</a>
<ul>
<li><a href="#org9a60f96">8.2.4.3.1. "Criteria" queries:  Yikes.</a></li>
<li><a href="#org3bf0811">8.2.4.3.2. <span class="done DONE">DONE</span> JPQL</a>
<ul>
<li><a href="#org40e82ea">8.2.4.3.2.1. <span class="todo TODO">TODO</span> fetch plans</a></li>
<li><a href="#orgbdcb150">8.2.4.3.2.2. <span class="done HOLD">HOLD</span> EclipseLink</a>
<ul>
<li><a href="#org90e3098">8.2.4.3.2.2.1. Download &amp; install</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#org07d0c78">8.2.5. Lombok</a></li>
<li><a href="#orgab3989e">8.2.6. Logging &amp; Telemetry</a></li>
<li><a href="#orge2ae957">8.2.7. Security &amp; Griefing</a></li>
<li><a href="#orgd589bf0">8.2.8. Documentation generation</a></li>
<li><a href="#org3462226">8.2.9. Automated testing</a>
<ul>
<li><a href="#orgdb52646">8.2.9.1. Unit</a></li>
<li><a href="#org6ceeaa2">8.2.9.2. Integration</a></li>
<li><a href="#org0727932">8.2.9.3. Database?</a></li>
</ul>
</li>
<li><a href="#org8e7201d">8.2.10. Command pattern, undo/redo trees</a></li>
<li><a href="#org81ebbd3">8.2.11. Well-known APIs</a>
<ul>
<li><a href="#orgbeb80f9">8.2.11.1. Documenting with something like Swagger</a></li>
</ul>
</li>
<li><a href="#org3ae68e8">8.2.12. Data export/import</a></li>
<li><a href="#org7773b5c">8.2.13. Packaging &#x2013; how the entire project is structured</a></li>
<li><a href="#org931e9d6">8.2.14. Stress testing, esp. for database</a></li>
<li><a href="#orga109618">8.2.15. SQL profiling, tracing</a></li>
<li><a href="#orgd3ba334">8.2.16. <span class="todo TODO">TODO</span> Object mappers (Domain/DTO)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-orga11ed1b" class="outline-2">
<h2 id="orga11ed1b"><span class="section-number-2">1</span> Overview</h2>
<div class="outline-text-2" id="text-1">
<p>
I'm going to keep a diary of my effort to develop a web app from soup to nuts.
</p>

<p>
The initial plans are in <a href="README.html">README.org</a>.
</p>
</div>
</div>

<div id="outline-container-org16a41b2" class="outline-2">
<h2 id="org16a41b2"><span class="section-number-2">2</span> Java</h2>
<div class="outline-text-2" id="text-2">
<p>
Currently running my wiki on JSPWiki on Tomcat 8 on Java 8.  I'd like to run a different process
on Java whatever-is-the-latest.  (Note: I can't.  See <a href="#jakarta-java-version-question">the Jakarta/Java version question</a>.
</p>

<p>
Looks like some process has kept Java up to date on my AWS server.  Yay.  Also, apparently,
openjdk is legal to use.  Yay.
</p>

<p>
<a href="https://adoptopenjdk.net/index.html">https://adoptopenjdk.net/index.html</a> has the builds for download.
</p>

<p>
<a href="https://docs.oracle.com/en/java/javase/11/">https://docs.oracle.com/en/java/javase/11/</a> has tool documentation (<code>javac</code>, <code>java</code>, etc.).  I
haven't yet found these docs in any downloaded packages.
</p>
</div>

<div id="outline-container-org5258471" class="outline-3">
<h3 id="org5258471"><span class="section-number-3">2.1</span> On a Mac</h3>
<div class="outline-text-3" id="text-2-1">
<p>
On a Mac, the OpenJDK 8 installer puts files in
<code>/Library/Java/JavaVirtualMachines/adoptopenjdk-8.jdk/Contents/Home/bin</code>, but I can't seem to
symlink them in to <code>/usr/bin</code>.
</p>
</div>
</div>

<div id="outline-container-org57c2854" class="outline-3">
<h3 id="org57c2854"><span class="section-number-3">2.2</span> Java EE</h3>
<div class="outline-text-3" id="text-2-2">
<p>
Well, first off, a <i>lot</i> has happened in the Java world since I left it, around 2005 or so.
(Pshew, was it really that long ago?  Oy.)
</p>

<p>
Java EE has become Jakarta EE, and is now managed by the Eclipse Foundation.  It appears that, as
of <span class="timestamp-wrapper"><span class="timestamp">&lt;2020-03-09 Mon&gt;</span></span>, Java EE 8 is the download (from Oracle), but, in future, I guess we'll be
getting new versions from <a href="https://jakarta.ee/">https://jakarta.ee/</a>.
</p>
</div>

<div id="outline-container-org320a0aa" class="outline-4">
<h4 id="jakarta-java-version-question"><span class="section-number-4">2.2.1</span> Question: Does Jakarta EE support any version of Java &gt;= 8?  Answer: apparently not. :(</h4>
<div class="outline-text-4" id="text-jakarta-java-version-question">
<p>
Based on this quote: <i>"We also have to move the APIs to support JDK 11."</i> from this article:
<a href="https://dzone.com/articles/jakarta-ee-8-and-beyond">https://dzone.com/articles/jakarta-ee-8-and-beyond</a>.
</p>

<p>
(Note: the jars probably still run just fine on higher versions of Java, I guess they just don't
take advantage of the latest features of the language.  I kinda don't care, so long as they run
properly.) 
</p>
</div>
</div>
</div>

<div id="outline-container-org98bcbb5" class="outline-3">
<h3 id="org98bcbb5"><span class="section-number-3">2.3</span> Editing in emacs</h3>
<div class="outline-text-3" id="text-2-3">
<p>
This might be a lost cause, but if you want to get away from magic tools like IntelliJ, Eclipse,
VS Code, &#x2026;
</p>

<p>
<a href="https://www.emacswiki.org/emacs/JavaDevelopmentEnvironment">https://www.emacswiki.org/emacs/JavaDevelopmentEnvironment</a>
</p>

<p>
<a href="https://blog.jmibanez.com/2019/03/31/emacs-as-java-ide-revisited.html">https://blog.jmibanez.com/2019/03/31/emacs-as-java-ide-revisited.html</a>
</p>
</div>
</div>
</div>

<div id="outline-container-org5381830" class="outline-2">
<h2 id="org5381830"><span class="section-number-2">3</span> Tomcat</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-orgebcf494" class="outline-3">
<h3 id="orgebcf494"><span class="section-number-3">3.1</span> On a Mac</h3>
<div class="outline-text-3" id="text-3-1">
<p>
Unzipped Tomcat 9 to <code>/opt</code>.
</p>

<p>
Created user <code>tomcat</code> using Mac "Users and Groups" control panel applet.  Disabled login by
<code>tomcat</code> with the following shell command:
</p>

<pre class="example">
sudo chpass -s /usr/bin/false tomcat
</pre>


<p>
chown'd the resulting directory (recursively) to user <code>tomcat</code>.
</p>

<p>
Created a simple <code>start-tomcat</code> (and analogous <code>stop-tomcat</code>) script in
<code>/opt/apache-tomcat-9.0.31/bin</code> directory:
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #36648b; font-style: italic;">#</span><span style="color: #36648b; font-style: italic;">!/bin/</span><span style="color: #a020f0;">bash</span>

<span style="color: #483d8b;">export</span> <span style="color: #8b6914;">CATALINA_HOME</span>=/opt/apache-tomcat-9.0.31

<span style="color: #36648b; font-style: italic;"># </span><span style="color: #36648b; font-style: italic;">export CATALINA_BASE=~/Tomcat/apache-tomcat-9.0</span>

<span style="color: #483d8b;">export</span> <span style="color: #8b6914;">JAVA_HOME</span>=/Library/Java/JavaVirtualMachines/adoptopenjdk-8.jdk/Contents/Home

<span style="color: #a020f0;">exec</span> su -m tomcat ${<span style="color: #8b6914;">CATALINA_HOME</span>}/bin/catalina.sh start
</pre>
</div>

<p>
Edited <code>/opt/apache-tomcat-9.0.31/conf/tomcat-users.xml</code> to add users for manager-gui, admin-gui
and (separate user) manager-script, admin-script.
</p>

<p>
Running on AdoptOpenJDK 11 is as easy as downloading and installing it and changing the above
<code>JAVA_HOME</code> to point to the new JDK.  It seems to run without problem.
</p>

<p>
It should also be possible to install it via homebrew, which might then keep it up to date better than a manual
install process would.
</p>

<p>
For homebrew, you'll need to open a "tap" (i.e., add another repository), and then install the "cask" for the jdk you
want.  See the instructions at the adoptopenjdk.
</p>
</div>
</div>

<div id="outline-container-orga5d4f4a" class="outline-3">
<h3 id="orga5d4f4a"><span class="section-number-3">3.2</span> On Ubuntu Linux 16.04</h3>
<div class="outline-text-3" id="text-3-2">
<p>
See <a href="http://tarheel-nc.s3-website-us-east-1.amazonaws.com/tomcat-9-setup.html">http://tarheel-nc.s3-website-us-east-1.amazonaws.com/tomcat-9-setup.html</a>.
</p>
</div>
</div>

<div id="outline-container-org6473f99" class="outline-3">
<h3 id="org6473f99"><span class="section-number-3">3.3</span> Deploy code</h3>
<div class="outline-text-3" id="text-3-3">
<p>
Well, first you have to write some code.  See <a href="#hello-world">Simplest possible code</a>.
</p>
</div>
</div>

<div id="outline-container-orgb0c5e12" class="outline-3">
<h3 id="tomcat-jndi-resources"><span class="section-number-3">3.4</span> <span class="todo IN_PROGRESS">IN-PROGRESS</span> JDBC connection and other external configs preserved between version upgrade</h3>
<div class="outline-text-3" id="text-tomcat-jndi-resources">
<p>
See <a href="https://serverfault.com/a/751477">https://serverfault.com/a/751477</a>
</p>

<p>
From <code>/opt/apache-tomcat-9.0.31/conf/server.xml</code>:
</p>

<pre class="example">
&lt;!-- Global JNDI resources
     Documentation at /docs/jndi-resources-howto.html
--&gt;
</pre>
</div>
</div>
</div>


<div id="outline-container-org0d29df6" class="outline-2">
<h2 id="org0d29df6"><span class="section-number-2">4</span> Database</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-org1096c0b" class="outline-3">
<h3 id="org1096c0b"><span class="section-number-3">4.1</span> Consider an ORM of some sort</h3>
<div class="outline-text-3" id="text-4-1">
<p>
This might require using a "more real" database than Sqlite.  Although it might be fun to try. :)
</p>

<p>
<a href="https://www.eversql.com/i-followed-hibernate-orm-to-hell-and-came-back-alive-to-tell-about-it/">https://www.eversql.com/i-followed-hibernate-orm-to-hell-and-came-back-alive-to-tell-about-it/</a>
</p>

<p>
<a href="https://hackr.io/blog/java-frameworks">https://hackr.io/blog/java-frameworks</a> &#x2013; Hibernate's in here, along with a <i>ton</i> of other
frameworks.  Sounds like a good page to refer back to.
</p>

<p>
EclipseLink is the reference implementation for JPA.
</p>
</div>
</div>

<div id="outline-container-orgdb65424" class="outline-3">
<h3 id="orgdb65424"><span class="section-number-3">4.2</span> SQLite</h3>
<div class="outline-text-3" id="text-4-2">
</div>
<div id="outline-container-orgda84e41" class="outline-4">
<h4 id="orgda84e41"><span class="section-number-4">4.2.1</span> How much does it scale?</h4>
<div class="outline-text-4" id="text-4-2-1">
<p>
For a toy app (on a toy server), I don't need much.
</p>

<p>
But&#x2026; it looks like it scales quite well, actually.
</p>

<p>
<a href="https://blog.expensify.com/2018/01/08/scaling-sqlite-to-4m-qps-on-a-single-server/">https://blog.expensify.com/2018/01/08/scaling-sqlite-to-4m-qps-on-a-single-server/</a>
</p>

<p>
<a href="https://stackoverflow.com/a/62220">https://stackoverflow.com/a/62220</a>
</p>

<p>
<a href="https://news.ycombinator.com/item?id=11934826">https://news.ycombinator.com/item?id=11934826</a>
</p>

<p>
<a href="https://www.whoishostingthis.com/compare/sqlite/optimize/">https://www.whoishostingthis.com/compare/sqlite/optimize/</a>
</p>
</div>
</div>
</div>

<div id="outline-container-org8682258" class="outline-3">
<h3 id="org8682258"><span class="section-number-3">4.3</span> Postgresql</h3>
<div class="outline-text-3" id="text-4-3">
<p>
Well, after all the Sqlite awesomeness, maybe I'll put this bad boy off a while more.  I don't
really intend to become a d/b geek.
</p>
</div>
</div>

<div id="outline-container-org82c0827" class="outline-3">
<h3 id="org82c0827"><span class="section-number-3">4.4</span> Apache Derby</h3>
<div class="outline-text-3" id="text-4-4">
<p>
Pure Java embedded database, but probably not as widely used as Sqlite.  Advantage: probably
works well with Hibernate and other Java technologies.  Derby seems to perform better.
</p>

<p>
As if I care, with my 12-record database.
</p>
</div>
</div>
</div>

<div id="outline-container-org4d907b5" class="outline-2">
<h2 id="org4d907b5"><span class="section-number-2">5</span> JavaEE</h2>
<div class="outline-text-2" id="text-5">
<p>
I feel like there's a license restriction on the EE libs from Oracle.  So I need to find an
implementation I can use.
</p>

<p>
Turns out&#x2026;
</p>

<blockquote>
<p>
The Apache Tomcat® software is an open source implementation of the Java Servlet, JavaServer
Pages, Java Expression Language and Java WebSocket technologies. The Java Servlet, JavaServer
Pages, Java Expression Language and Java WebSocket specifications are developed under the Java
Community Process.
</p>
</blockquote>

<p>
(From <a href="https://tomcat.apache.org/">https://tomcat.apache.org/</a>, right at the top.)
</p>

<p>
This at least satisfies the compiler:
</p>

<pre class="example">
javac -cp /opt/apache-tomcat-9.0.31/lib/servlet-api.jar com/how_hard_can_it_be/play/Main.java
</pre>
</div>

<div id="outline-container-org2425ed6" class="outline-3">
<h3 id="org2425ed6"><span class="section-number-3">5.1</span> Dependencies</h3>
<div class="outline-text-3" id="text-5-1">
<p>
<i>I think</i> you can also add them via Maven (from
<a href="https://mvnrepository.com/artifact/javax.servlet/javax.servlet-api/4.0.1">https://mvnrepository.com/artifact/javax.servlet/javax.servlet-api/4.0.1</a>):
</p>

<p>
See <a href="#how-to-make-javax-servlet-dependencies-available">How to make <code>javax.servlet</code> dependencies available</a>, below.
</p>
</div>
</div>

<div id="outline-container-org0bee24e" class="outline-3">
<h3 id="org0bee24e"><span class="section-number-3">5.2</span> JavaEE (JakartaEE) specs</h3>
<div class="outline-text-3" id="text-5-2">
<p>
JavaEE is a big umbrella.  Here's a table listing all the subparts and versions:
</p>

<p>
<a href="https://javaee.github.io/javaee-spec/Specifications">https://javaee.github.io/javaee-spec/Specifications</a>
</p>

<p>
or
</p>

<p>
<a href="https://jakarta.ee/">https://jakarta.ee/</a>
</p>
</div>
</div>

<div id="outline-container-org3794fb5" class="outline-3">
<h3 id="org3794fb5"><span class="section-number-3">5.3</span> JavaEE tutorial</h3>
<div class="outline-text-3" id="text-5-3">
<p>
Version 8: <a href="https://javaee.github.io/tutorial/">https://javaee.github.io/tutorial/</a>
</p>

<p>
This thing is monstrous.  Also, this "tutorial" isn't very gentle; it's more like a reference (I
like that).
</p>
</div>
</div>
</div>

<div id="outline-container-orgea998d0" class="outline-2">
<h2 id="orgea998d0"><span class="section-number-2">6</span> JS Framework</h2>
</div>

<div id="outline-container-orgcf6cd5d" class="outline-2">
<h2 id="orgcf6cd5d"><span class="section-number-2">7</span> Build system</h2>
<div class="outline-text-2" id="text-7">
</div>
<div id="outline-container-org20cc3c3" class="outline-3">
<h3 id="org20cc3c3"><span class="section-number-3">7.1</span> Gradle</h3>
<div class="outline-text-3" id="text-7-1">
<p>
Gradle is not the clean, well-documented system I had hoped for.  Maybe if this turns into a big,
giant project, it might pay off, but there seems to be a ton of black magic documented in example
code and (probably) StackOverflow answers, so&#x2026; maybe just use Maven.
</p>
</div>
</div>

<div id="outline-container-orgc3c4093" class="outline-3">
<h3 id="maven"><span class="section-number-3">7.2</span> <span class="done RESEARCH_DONE">RESEARCH-DONE</span> Maven</h3>
<div class="outline-text-3" id="text-maven">
<p>
Back to Maven, until I give up on it again.
</p>

<p>
Need to figure out how to download dependencies over https.  (Answer: switch the urls to be
"https" instead of "http".  Also, purge your local <code>.m2</code> repository and let it get repopulated.)
</p>

<p>
Need to figure out a project structure.  Somewhere between simple-weapp and J2EE-webapp.
</p>
</div>

<div id="outline-container-org04665b9" class="outline-4">
<h4 id="org04665b9"><span class="section-number-4">7.2.1</span> Install/update</h4>
<div class="outline-text-4" id="text-7-2-1">
<p>
Update maven, configure PATH.  (Is that really all I have to do?)  On a Mac.
</p>

<p>
Ok, so, I just downloaded the zip from Apache, unzipped it into <code>/opt</code> and symlinked the <i>three</i>
executable files in the <code>bin</code> directory to <code>/usr/local/bin</code>, which is already on the path.
</p>
</div>
</div>

<div id="outline-container-orgeb9fa89" class="outline-4">
<h4 id="orgeb9fa89"><span class="section-number-4">7.2.2</span> <span class="done RESEARCH_DONE">RESEARCH-DONE</span> Make a project</h4>
<div class="outline-text-4" id="text-7-2-2">
<p>
After much reading of Maven docs (finally), I think something like the J2EE project structure
(below, but you probably don't need to go read it) is the way to go.  All I ever built in the
past was a single Maven project, but a project (parent or aggregate, packaging = <code>pom</code>) that has
the following sub-projects shouldn't be too hard.
</p>

<ul class="org-ul">
<li>business logic, with minimal dependencies (onion architecture core)</li>
<li>utilities I will probably use in other projects (again, minimal dependencies, and particularly
no dependencies on UI or d/b layers).  Maybe this is where I'd put interface/facade code for
common stuff like logging.</li>
<li>the actual web stuff, which would probably be a pretty thin layer around the business logic.
One exception to the "thin layer" concept is that I guess this is where I'd stick all my
super-fancy javascript UI stuff.  The server would probably concentrate on returning JSON
responses to RESTful (?) queries.</li>
</ul>

<p>
Wonder if I can create these as completely independent of each other (i.e., in different
directories, not subdirectories) and then tie them all together with the parent POM.  See
<a href="https://maven.apache.org/pom.html#Aggregation">https://maven.apache.org/pom.html#Aggregation</a>.  Answer: yes.  (But I'm not doing it right away.)
</p>

<p>
Basically: (1) create a parent project (once), cd into the parent project directory, and (2)
create sub-projects, Archetypes to be used:
</p>

<ul class="org-ul">
<li>maven-archetype-quickstart (parent and jar-type subs)</li>
<li>maven-archetype-webapp (probably just need one of these)</li>
</ul>

<blockquote>
<p>
(Note: there might be some scary warnings at the beginning about HTTPS being required, but it works
ok for setting up the initial project.  In my case, they came from my old <code>.m2</code> repository, and
when I blew it away, the errors cleared up (because new versions got downloaded).)
</p>
</blockquote>

<p>
Then, change the packaging of the parent project to <code>pom</code>, add the subprojects, etc., etc., as
documented at
<a href="https://maven.apache.org/guides/getting-started/index.html#How_do_I_build_more_than_one_project_at_once">https://maven.apache.org/guides/getting-started/index.html#How_do_I_build_more_than_one_project_at_once</a>.
</p>

<p>
<span class="timestamp-wrapper"><span class="timestamp">&lt;2020-03-31 Tue&gt; </span></span> This works.  The trick is to run <code>mvn install</code> at the root (parent) level, so
all depdendent projects <i>plus</i> the parent POM get installed to the local repository (<code>~/.m2</code> by
default).  Apparently, that parent POM is important.
</p>
</div>

<div id="outline-container-org4d03ce7" class="outline-5">
<h5 id="org4d03ce7"><span class="section-number-5">7.2.2.1</span> Effective POM</h5>
<div class="outline-text-5" id="text-7-2-2-1">
<pre class="example">
mvn help:effective-pom
</pre>


<p>
Shows super-POM merged w/your POM (or inherited POM hierarchy, if you are so bold).
</p>
</div>
</div>

<div id="outline-container-orga56250c" class="outline-5">
<h5 id="orga56250c"><span class="section-number-5">7.2.2.2</span> Patching up generated POMs</h5>
<div class="outline-text-5" id="text-7-2-2-2">
<p>
Looks like Maven generates POMs that need a little more detail.  (Or sometimes, they have too
much detail, like for really old JDK versions.)
</p>

<p>
I put these property definitions at the end of the "header" section of the POM:
</p>

<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #0000ff;">properties</span>&gt;
  &lt;<span style="color: #0000ff;">maven.compiler.source</span>&gt;11&lt;/<span style="color: #0000ff;">maven.compiler.source</span>&gt;
  &lt;<span style="color: #0000ff;">maven.compiler.target</span>&gt;11&lt;/<span style="color: #0000ff;">maven.compiler.target</span>&gt;
  &lt;<span style="color: #0000ff;">project.build.sourceEncoding</span>&gt;UTF-8&lt;/<span style="color: #0000ff;">project.build.sourceEncoding</span>&gt;
&lt;/<span style="color: #0000ff;">properties</span>&gt;
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd175865" class="outline-5">
<h5 id="orgd175865"><span class="section-number-5">7.2.2.3</span> How to define servlets (where the source code goes)</h5>
<div class="outline-text-5" id="text-7-2-2-3">
<p>
Servlet source code goes in web project, in directory
<code>src/main/java/&lt;package-directory-structure&gt;/FooServlet.java</code>.  Binary winds up in the war file
in <code>WEB-INF/classes</code>.
</p>
</div>
</div>

<div id="outline-container-org1da89b4" class="outline-5">
<h5 id="how-to-make-javax-servlet-dependencies-available"><span class="section-number-5">7.2.2.4</span> How to make <code>javax.servlet</code> dependencies available</h5>
<div class="outline-text-5" id="text-how-to-make-javax-servlet-dependencies-available">
<p>
Tomcat 9 provides:
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-left"><b>Spec</b></td>
<td class="org-right"><b>Version</b></td>
</tr>

<tr>
<td class="org-left">Servlet</td>
<td class="org-right">4.0</td>
</tr>

<tr>
<td class="org-left">JSP</td>
<td class="org-right">2.3</td>
</tr>

<tr>
<td class="org-left">EL</td>
<td class="org-right">3.0</td>
</tr>

<tr>
<td class="org-left">WebSocket</td>
<td class="org-right">1.1</td>
</tr>

<tr>
<td class="org-left">JASIC (authentication)</td>
<td class="org-right">1.1</td>
</tr>
</tbody>
</table>

<p>
I'm <i>guessing</i> we won't need the JSP and EL specs, since we'll (probably) be emiting JSON, not
HTML.
</p>

<p>
So, we need something like the following:
</p>

<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #0000ff;">dependency</span>&gt;
  &lt;<span style="color: #0000ff;">groupId</span>&gt;javax.servlet&lt;/<span style="color: #0000ff;">groupId</span>&gt;
  &lt;<span style="color: #0000ff;">artifactId</span>&gt;javax.servlet-api&lt;/<span style="color: #0000ff;">artifactId</span>&gt;
  &lt;<span style="color: #0000ff;">version</span>&gt;3.0.1&lt;/<span style="color: #0000ff;">version</span>&gt;
  &lt;<span style="color: #0000ff;">scope</span>&gt;provided&lt;/<span style="color: #0000ff;">scope</span>&gt;  <span style="color: #36648b; font-style: italic;">&lt;!--  "provided" means we need this JAR for a successful compile, but it won't be included in</span>
<span style="color: #36648b; font-style: italic;">                                 the generated output, because we expect the container to which the generated WAR is</span>
<span style="color: #36648b; font-style: italic;">                                 deployed to provide its own compatible version of the JAR.</span>
<span style="color: #36648b; font-style: italic;">                           --&gt;</span>
&lt;/<span style="color: #0000ff;">dependency</span>&gt;
</pre>
</div>

<p>
But the version we need is probably 4.0.x?
</p>

<p>
The effective POM has Maven Central at <a href="https://repo.maven.apache.org/maven2">https://repo.maven.apache.org/maven2</a>.  So&#x2026; from the
versions listed at <a href="https://repo.maven.apache.org/maven2/javax/servlet/javax.servlet-api/">https://repo.maven.apache.org/maven2/javax/servlet/javax.servlet-api/</a>, it
looks like maybe 4.0.1 is the version we want.
</p>

<p>
Searching at <a href="https://search.maven.org/">https://search.maven.org/</a> with search <code>g:javax.servlet a:javax.servlet-api</code> yields
a hit.  Clicking on the result (try the artifact id or the version count) yields a snippet of
info, including the GitHub repository and home page.
</p>

<p>
And, finally, after all that&#x2026; we build (<code>mvn package</code>), and&#x2026; voila!  (It got automatically
downloaded and the compile succeeds, after we updated our tiny class to have a dependency on
<code>HttpServlet</code>.)
</p>

<pre class="example">
deimos$ pwd
/Users/john/.m2/repository/javax/servlet/javax.servlet-api/4.0.1

deimos$ lscf
_remote.repositories                      javax.servlet-api-4.0.1.jar
javax.servlet-api-4.0.1-javadoc.jar       javax.servlet-api-4.0.1.jar.sha1
javax.servlet-api-4.0.1-javadoc.jar.sha1  javax.servlet-api-4.0.1.pom
javax.servlet-api-4.0.1-sources.jar       javax.servlet-api-4.0.1.pom.sha1
javax.servlet-api-4.0.1-sources.jar.sha1  m2e-lastUpdated.properties
</pre>

<p>
(Whether it runs is something we'll find out later.  (Answer: it does.))
</p>

<p>
The next step, I think, is to fix up routing so a url will go to the servlet.  See <a href="#servlet-routing">Servlet
Routing</a>.
</p>
</div>
</div>

<div id="outline-container-orge72531b" class="outline-5">
<h5 id="j2ee-project-structure"><span class="section-number-5">7.2.2.5</span> File structure for "simple J2EE" (ha)</h5>
<div class="outline-text-5" id="text-j2ee-project-structure">
<p>
I don't think I need all of the J2EE project stuff, such as the EJBs and the "ear" folder, but
the rest are probably good.  I guess I could just delete the unwanted directories and remove
references to them from the ancester POMs.  Then, the final deliverable is the "servlets" (or
"servlets/servlet") project, packaged as war.
</p>

<p>
The project dir root contains the following (<span class="open-question"> open
questions </span> are presented in the indicated style):
</p>

<ul class="org-ul">
<li>pom.xml &#x2013; overall POM</li>
<li>primary-source &#x2013; core/unique business logic
<ul class="org-ul">
<li>pom.xml &#x2013; sub-POM for the main source, which is a jar</li>
<li>src
<ul class="org-ul">
<li>main
<ul class="org-ul">
<li>java
<ul class="org-ul">
<li>com
<ul class="org-ul">
<li>how_hard_can_it_be.com
<ul class="org-ul">
<li>offtotheraces</li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
<li>test
<ul class="org-ul">
<li>java</li>
</ul></li>
</ul></li>
<li>target &#x2013; all the magic that Maven does, probably includes the jar generated from primary-source</li>
</ul></li>
<li>projects &#x2013; <span class="open-question"> secondary/reusable source, I guess </span>
<ul class="org-ul">
<li>pom.xml</li>
<li>logging &#x2013; sample project
<ul class="org-ul">
<li>pom.xml &#x2013; each project gets its own POM</li>
<li>src
<ul class="org-ul">
<li>main
<ul class="org-ul">
<li>java</li>
</ul></li>
<li>test
<ul class="org-ul">
<li>java</li>
</ul></li>
</ul></li>
<li>target &#x2013; Maven-generated</li>
</ul></li>
</ul></li>
<li>servlets (plural) &#x2013; actual JSPs and servlets, which should be thin logic around the business
logic.  Note also that, buried below here, are the static files for the web app (js, css,
images, etc.)
<ul class="org-ul">
<li>pom.xml</li>
<li>servlet (singular) &#x2013; <span class="open-question"> Not sure why there's a singular
"servlet" directory under the plural "servlets" directory. </span>
<ul class="org-ul">
<li>src
<ul class="org-ul">
<li>main
<ul class="org-ul">
<li>java</li>
<li>webapp
<ul class="org-ul">
<li>WEB-INF
<ul class="org-ul">
<li>web.xml</li>
</ul></li>
<li>index.jsp</li>
<li><i>(other JSPs and static resources (css, js, images, etc.), presumably</i></li>
</ul></li>
</ul></li>
<li>test
<ul class="org-ul">
<li>java</li>
</ul></li>
</ul></li>
<li>target</li>
</ul></li>
</ul></li>
<li>ejbs &#x2013; <span class="open-question"> I guess these are also thin layers around
business logic </span> 
<ul class="org-ul">
<li>pom.xml</li>
<li>src
<ul class="org-ul">
<li>main
<ul class="org-ul">
<li>java</li>
<li>resource &#x2013; resource bundles for configuration, i18n, similar stuff?
<ul class="org-ul">
<li>META-INF
<ul class="org-ul">
<li>ejb-jar.xml - <span class="open-question"> No idea what this is
</span></li>
</ul></li>
</ul></li>
</ul></li>
<li>test
<ul class="org-ul">
<li>java</li>
</ul></li>
</ul></li>
<li>target</li>
</ul></li>
<li>ear &#x2013; <span class="open-question"> I have no idea what goes in here </span> 
<ul class="org-ul">
<li>pom.xml</li>
<li>src
<ul class="org-ul">
<li>main
<ul class="org-ul">
<li>java</li>
</ul></li>
<li>test
<ul class="org-ul">
<li>java</li>
</ul></li>
</ul></li>
<li>target</li>
</ul></li>
</ul>
</div>
</div>

<div id="outline-container-org0c6a647" class="outline-5">
<h5 id="org0c6a647"><span class="section-number-5">7.2.2.6</span> Further info on the "simple" J2EE packaging, from reference docs</h5>
<div class="outline-text-5" id="text-7-2-2-6">
<p>
<a href="https://maven.apache.org/archetypes/maven-archetype-j2ee-simple/index.html">https://maven.apache.org/archetypes/maven-archetype-j2ee-simple/index.html</a>
</p>
</div>
</div>
</div>

<div id="outline-container-orgf97d2b3" class="outline-4">
<h4 id="orgf97d2b3"><span class="section-number-4">7.2.3</span> Reactor?  What's that?</h4>
<div class="outline-text-4" id="text-7-2-3">
<p>
Built-in part of Maven that decides in what order to build component modules (sub-projects),
given their interdependencies.  Not a plug-in; don't sweat it.
</p>
</div>
</div>

<div id="outline-container-org3603277" class="outline-4">
<h4 id="org3603277"><span class="section-number-4">7.2.4</span> Useful sites</h4>
<div class="outline-text-4" id="text-7-2-4">
<ul class="org-ul">
<li><a href="https://mvnrepository.com">https://mvnrepository.com</a></li>

<li><a href="https://repo.maven.apache.org/maven2/">https://repo.maven.apache.org/maven2/</a></li>

<li><a href="https://search.maven.org/">https://search.maven.org/</a> (i.e., Sonatype, a major supporter of Maven)</li>

<li><a href="https://javadoc.io/">https://javadoc.io/</a></li>
</ul>
</div>
</div>
</div>
</div>

<div id="outline-container-orgfd8b220" class="outline-2">
<h2 id="orgfd8b220"><span class="section-number-2">8</span> App code</h2>
<div class="outline-text-2" id="text-8">
</div>
<div id="outline-container-orgf025b5e" class="outline-3">
<h3 id="hello-world"><span class="section-number-3">8.1</span> Simplest possible code</h3>
<div class="outline-text-3" id="text-hello-world">
<div class="org-src-container">
<pre class="src src-java"><span style="color: #008b8b;">@WebServlet</span>(urlPatterns = { <span style="color: #b22222;">"/hello"</span> })
<span style="color: #a020f0;">public</span> <span style="color: #a020f0;">class</span> <span style="color: #228b22;">HelloServlet</span> <span style="color: #a020f0;">extends</span> <span style="color: #228b22;">HttpServlet</span>
{
   <span style="color: #a020f0;">public</span> <span style="color: #228b22;">void</span> <span style="color: #0000ff;">doGet</span>(<span style="color: #228b22;">HttpServletRequest</span> <span style="color: #8b6914;">aRequest</span>, <span style="color: #228b22;">HttpServletResponse</span> <span style="color: #8b6914;">aResponse</span>) 
      <span style="color: #a020f0;">throws</span> <span style="color: #228b22;">ServletException</span>, <span style="color: #228b22;">IOException</span>
   {
      aRequest.getServletContext().getRequestDispatcher(<span style="color: #b22222;">"/index.jsp"</span>).forward(aRequest, aResponse);
   }
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org2eeb9b0" class="outline-3">
<h3 id="org2eeb9b0"><span class="section-number-3">8.2</span> Other aspects to consider</h3>
<div class="outline-text-3" id="text-8-2">
</div>
<div id="outline-container-orga4b3509" class="outline-4">
<h4 id="servlet-routing"><span class="section-number-4">8.2.1</span> Servlet Routing</h4>
<div class="outline-text-4" id="text-servlet-routing">
<p>
How to define routings so that URLs map to servlets.
</p>

<p>
Servlet mappings.  Chapter 12 of the Servlet 4.0 spec, available at
<a href="https://javaee.github.io/servlet-spec/downloads/servlet-4.0/servlet-4_0_FINAL.pdf">https://javaee.github.io/servlet-spec/downloads/servlet-4.0/servlet-4_0_FINAL.pdf</a>.
</p>

<p>
Also, use the <code>WebServlet</code> annotation to specify mappings at the level of each servlet, so you
don't have to go edit <code>web.xml</code>.
</p>
</div>
</div>

<div id="outline-container-org814ada6" class="outline-4">
<h4 id="org814ada6"><span class="section-number-4">8.2.2</span> JSON output</h4>
<div class="outline-text-4" id="text-8-2-2">
<p>
Is there an easy way?  Or do I just call <code>toJson()</code> on some object and write it to the response
stream?
</p>

<p>
Actually, it looks pretty simple.
</p>

<p>
See <a href="https://www.baeldung.com/servlet-json-response">https://www.baeldung.com/servlet-json-response</a>, but basically, it's:
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #228b22;">String</span> <span style="color: #8b6914;">employeeJsonString</span> = <span style="color: #a020f0;">new</span> <span style="color: #228b22;">Gson</span>().toJson(employee);
<span style="color: #228b22;">PrintWriter</span> <span style="color: #8b6914;">out</span> = response.getWriter();
response.setContentType(<span style="color: #b22222;">"application/json"</span>);
response.setCharacterEncoding(<span style="color: #b22222;">"UTF-8"</span>);
out.print(employeeJsonString);
out.flush();
</pre>
</div>

<p>
<i>Gson</i> is Google's JSON serializer.  <i>Jackson</i> is the more "standard" java-world serializer,
and, like all things Java-world, it's both more complex and more powerful (I guess).
</p>
</div>
</div>

<div id="outline-container-org07e9e2c" class="outline-4">
<h4 id="org07e9e2c"><span class="section-number-4">8.2.3</span> <span class="done DONE">DONE</span> Dependency Injection</h4>
<div class="outline-text-4" id="text-8-2-3">
<p>
Implementations of CDI spec.
</p>

<p>
Servlet construction-time parameters, injection?
</p>

<p>
Or do we just have a global resolver and use it all over the place?
</p>

<p>
Note that the full-blown CDI spec builds on the "dependency injection" spec, so we may not need
the full-blown CDI.  (On the other hand, maybe we <i>do</i> want to go ahead and use it, so we don't
have to make the transition to it later, when my project becomes a huge enterprise church CRM
system with thousands of subscribers.  Or just so I can learn it.)
</p>
</div>

<div id="outline-container-org9ac5dc6" class="outline-5">
<h5 id="org9ac5dc6"><span class="section-number-5">8.2.3.1</span> Setup</h5>
<div class="outline-text-5" id="text-8-2-3-1">
<p>
Supposedly simple tutorial at <a href="https://hradecek.github.io/posts/cdi-in-tomcat">https://hradecek.github.io/posts/cdi-in-tomcat</a>.
</p>

<p>
Also, the Weld reference manual has info in the chapter on "Application servers and environments
supported by Weld" (specifically, the sections on "Servlet containers" and "Tomcat").  It's
mostly a matter of adding the Maven dependency blobs specified in the reference manual to your
pom.xml, web.xml, and context.xml.
</p>
</div>

<div id="outline-container-org0f58461" class="outline-6">
<h6 id="org0f58461"><span class="section-number-6">8.2.3.1.1</span> <span class="done DONE">DONE</span> Creating injected beans in another module</h6>
<div class="outline-text-6" id="text-8-2-3-1-1">
<p>
Trying to move injected beans to another module (jar packaging) and I need to get a
META-INF/beans.xml file in it, somehow (I think).
</p>

<p>
Answer: <code>META-INF</code> goes in <code>resources</code> directory.  Only java code goes in <code>java</code> directory.
See <a href="https://stackoverflow.com/a/13057183">https://stackoverflow.com/a/13057183</a>.
</p>
</div>

<div id="outline-container-org6a47b08" class="outline-7">
<h7 id="org6a47b08"><span class="section-number-7">8.2.3.1.1.1</span> <span class="todo TODO">TODO</span> Bean scoping</h7>
<div class="outline-text-7" id="text-8-2-3-1-1-1">
<p>
I have a bean injected as the private data member of a servlet.  Is there a default scope?
What is it?  Should I explicitly scope my bean?  To <code>@Dependent</code>, maybe?
</p>
</div>
</div>

<div id="outline-container-orgc02ad0e" class="outline-7">
<h7 id="orgc02ad0e"><span class="section-number-7">8.2.3.1.1.2</span> <span class="todo TODO">TODO</span> <code>beans.xml</code> is optional, supposedly</h7>
<div class="outline-text-7" id="text-8-2-3-1-1-2">
<p>
I guess that means all beans have to have scope annotations?  Is there a more generic
<code>@InjectedBean</code> annotation I can use, or do I just slap on scope annotations?
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org0933105" class="outline-5">
<h5 id="org0933105"><span class="section-number-5">8.2.3.2</span> Background info</h5>
<div class="outline-text-5" id="text-8-2-3-2">
<p>
From <a href="https://projects.eclipse.org/proposals/jakarta-contexts-and-dependency-injection">https://projects.eclipse.org/proposals/jakarta-contexts-and-dependency-injection</a>:
</p>

<blockquote>
<p>
Unlike most of the Java EE specifications, Contexts and Dependency Injection was led by a
non-Oracle organization, namely Red Hat.
</p>

<p>
The project aims to continue the standardization work of the Contexts and Dependency Injection
(CDI) specification, which is part of the Java EE platform, but which also is designed since
version 2.0 for use in Java SE environments. Previous revisions of that specification were
created under the Java Community Process (JCP):
</p>

<ul class="org-ul">
<li>CDI 1.0 (JSR 299), part of Java EE 6</li>
<li>CDI 1.1 and 1.2 (JSR 346), part of Java EE 7</li>
<li>CDI 2.0 (JSR 365), part of Java EE 8</li>
</ul>
</blockquote>
</div>
</div>
</div>

<div id="outline-container-org3a0e730" class="outline-4">
<h4 id="org3a0e730"><span class="section-number-4">8.2.4</span> <span class="todo IN_PROGRESS">IN-PROGRESS</span> Persistence</h4>
<div class="outline-text-4" id="text-8-2-4">
</div>
<div id="outline-container-org4ae819e" class="outline-5">
<h5 id="org4ae819e"><span class="section-number-5">8.2.4.1</span> <span class="done DONE">DONE</span> SQLite (for now)</h5>
<div class="outline-text-5" id="text-8-2-4-1">
<ul class="org-ul">
<li>CLOSING NOTE <span class="timestamp-wrapper"><span class="timestamp">[2020-04-12 Sun 12:17] </span></span> <br />
Picked SQLite, now handling sub-issues (see below).</li>
</ul>

<p>
But maybe Derby later as an exercise in another d/b layer.
</p>
</div>

<div id="outline-container-orgd81a2eb" class="outline-6">
<h6 id="orgd81a2eb"><span class="section-number-6">8.2.4.1.1</span> <span class="done DONE">DONE</span> Create a play sqlite database</h6>
<div class="outline-text-6" id="text-8-2-4-1-1">
<p>
Before we play around with JPQL and EclipseLink and all that, we need a database.  The one
from <a href="http://tarheel-nc.s3-website-us-east-1.amazonaws.com/sql-basics.html">http://tarheel-nc.s3-website-us-east-1.amazonaws.com/sql-basics.html</a> should do.
</p>

<p>
But first, since "Entity" is such a terrible name for entities, I edited the "load" sql script
to replace "Entity" with "Monster", so it's a database of monsters, with tags.
</p>

<p>
To load it&#x2026; use SQLite Studio.  (Or you could do it from the command line, I guess, but I
don't know how to do that easily.)
</p>

<p>
Create a new database and connect to it.
</p>

<p>
Open a SQL editor, load the "load" file, select all the text and run it.  (Apparently, running
w/out selecting all text results in only one statement being run.)
</p>

<p>
Results in a 28k database file, so, not too big.
</p>
</div>

<div id="outline-container-org08f7419" class="outline-7">
<h7 id="org08f7419"><span class="section-number-7">8.2.4.1.1.1</span> <span class="todo TODO">TODO</span> Where to put it?</h7>
<div class="outline-text-7" id="text-8-2-4-1-1-1">
<p>
I dunno, but probably not in the resource directory, since that'll be inside the jar and
probably not updateable.  Maybe put an empty copy of the d/b in the resources directory so at
runtime, it can be used as a template for a new d/b (if needed), and have a property
specifying the location of the actual d/b somewhere?
</p>

<p>
Which begs the question: how to specify properties, both outside (actual value) and inside
(default value) the jar?
</p>
</div>
</div>

<div id="outline-container-org44928fe" class="outline-7">
<h7 id="org44928fe"><span class="section-number-7">8.2.4.1.1.2</span> <span class="done DONE">DONE</span> jar properties</h7>
<div class="outline-text-7" id="text-8-2-4-1-1-2">
<ul class="org-ul">
<li>CLOSING NOTE <span class="timestamp-wrapper"><span class="timestamp">[2020-04-12 Sun 15:06] </span></span> <br />
Not the answer.</li>
</ul>

<p>
The property I want is the location of the database.
</p>

<p>
Actually, this isn't the answer, but read on (<a href="#command-line-properties">Command-line (or otherwise run-time) properties</a>).
</p>
</div>
</div>

<div id="outline-container-orgb42b641" class="outline-7">
<h7 id="command-line-properties"><span class="section-number-7">8.2.4.1.1.3</span> <span class="todo IN_PROGRESS">IN-PROGRESS</span> Command-line (or otherwise run-time) properties</h7>
<div class="outline-text-7" id="text-command-line-properties">
<p>
<code>System.getProperty()</code> ?
</p>

<p>
Gets more complicated for a webapp, because you don't get a command line to fiddle around with.
</p>

<p>
Looks like the answer is JNDI (great! another thing to learn!)
</p>

<p>
See <a href="#tomcat-jndi-resources">JDBC connection and other external configs preserved between version upgrade</a>.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orga81dbf9" class="outline-5">
<h5 id="orga81dbf9"><span class="section-number-5">8.2.4.2</span> Connect to SQLite d/b using JDBC</h5>
<div class="outline-text-5" id="text-8-2-4-2">
</div>
<div id="outline-container-org4bd68f6" class="outline-6">
<h6 id="org4bd68f6"><span class="section-number-6">8.2.4.2.1</span> <span class="todo IN_PROGRESS">IN-PROGRESS</span> sqlite driver</h6>
<div class="outline-text-6" id="text-8-2-4-2-1">
<p>
Looks like the Xerial one is the most commonly-used.  Not hard to find at <a href="https://mvnrepository.com">https://mvnrepository.com</a>.
</p>
</div>
</div>
</div>

<div id="outline-container-orgdcfcef6" class="outline-5">
<h5 id="orgdcfcef6"><span class="section-number-5">8.2.4.3</span> <span class="done HOLD">HOLD</span> Java Persistence API (JPA)</h5>
<div class="outline-text-5" id="text-8-2-4-3">
</div>

<div id="outline-container-org9a60f96" class="outline-6">
<h6 id="org9a60f96"><span class="section-number-6">8.2.4.3.1</span> "Criteria" queries:  Yikes.</h6>
<div class="outline-text-6" id="text-8-2-4-3-1">
<p>
Typesafe queries, but it seems (a) like a lot of work, and (b) to assume I have a knowledge of
JPQL.  Accordingly, let's learn about JPQL first.
</p>
</div>
</div>

<div id="outline-container-org3bf0811" class="outline-6">
<h6 id="org3bf0811"><span class="section-number-6">8.2.4.3.2</span> <span class="done DONE">DONE</span> JPQL</h6>
<div class="outline-text-6" id="text-8-2-4-3-2">
<ul class="org-ul">
<li>CLOSING NOTE <span class="timestamp-wrapper"><span class="timestamp">[2020-04-09 Thu 15:27] </span></span> <br />
Well, I <b>read</b> about it.</li>
</ul>

<p>
Java Persistence Query Language.  Requires typecasting of query results, but is closer to SQL,
so maybe easier to learn.
</p>

<p>
(Obviously, the advantage of abstracting over the particular relational d/b is the code can be
neutral with respect to vendor SQL dialects.)
</p>
</div>

<div id="outline-container-org40e82ea" class="outline-7">
<h7 id="org40e82ea"><span class="section-number-7">8.2.4.3.2.1</span> <span class="todo TODO">TODO</span> fetch plans</h7>
<div class="outline-text-7" id="text-8-2-4-3-2-1">
<p>
Need to figure out how to get these (and whether they're useful).
</p>
</div>
</div>

<div id="outline-container-orgbdcb150" class="outline-7">
<h7 id="orgbdcb150"><span class="section-number-7">8.2.4.3.2.2</span> <span class="done HOLD">HOLD</span> EclipseLink</h7>
<div class="outline-text-7" id="text-8-2-4-3-2-2">
<ul class="org-ul">
<li>State "HOLD"       from "IN-PROGRESS" <span class="timestamp-wrapper"><span class="timestamp">[2020-04-10 Fri 17:50] </span></span> <br />
Waiting for a simple JDBC connection.</li>
</ul>

<p>
Need to get started writing some code with this.
</p>
</div>

<div id="outline-container-org90e3098" class="outline-8">
<h8 id="org90e3098"><span class="section-number-8">8.2.4.3.2.2.1</span> Download &amp; install</h8>
<div class="outline-text-8" id="text-8-2-4-3-2-2-1">
<p>
Bleah, maybe I should start with a simple JDBC connection before I go crazy on JPA.
</p>
</div>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org07d0c78" class="outline-4">
<h4 id="org07d0c78"><span class="section-number-4">8.2.5</span> Lombok</h4>
<div class="outline-text-4" id="text-8-2-5">
<p>
<a href="https://projectlombok.org/">https://projectlombok.org/</a>
</p>

<p>
MvnRepository has it at <a href="https://mvnrepository.com/artifact/org.projectlombok/lombok">https://mvnrepository.com/artifact/org.projectlombok/lombok</a>.
</p>

<p>
Might be simplest to just slap a <code>@Data</code> annotation on things you expect to use it on.  (Business
objects, mostly?  I assume not DTOs, really).
</p>
</div>
</div>

<div id="outline-container-orgab3989e" class="outline-4">
<h4 id="orgab3989e"><span class="section-number-4">8.2.6</span> Logging &amp; Telemetry</h4>
</div>
<div id="outline-container-orge2ae957" class="outline-4">
<h4 id="orge2ae957"><span class="section-number-4">8.2.7</span> Security &amp; Griefing</h4>
</div>
<div id="outline-container-orgd589bf0" class="outline-4">
<h4 id="orgd589bf0"><span class="section-number-4">8.2.8</span> Documentation generation</h4>
</div>
<div id="outline-container-org3462226" class="outline-4">
<h4 id="org3462226"><span class="section-number-4">8.2.9</span> Automated testing</h4>
<div class="outline-text-4" id="text-8-2-9">
</div>
<div id="outline-container-orgdb52646" class="outline-5">
<h5 id="orgdb52646"><span class="section-number-5">8.2.9.1</span> Unit</h5>
</div>
<div id="outline-container-org6ceeaa2" class="outline-5">
<h5 id="org6ceeaa2"><span class="section-number-5">8.2.9.2</span> Integration</h5>
</div>
<div id="outline-container-org0727932" class="outline-5">
<h5 id="org0727932"><span class="section-number-5">8.2.9.3</span> Database?</h5>
</div>
</div>
<div id="outline-container-org8e7201d" class="outline-4">
<h4 id="org8e7201d"><span class="section-number-4">8.2.10</span> Command pattern, undo/redo trees</h4>
</div>
<div id="outline-container-org81ebbd3" class="outline-4">
<h4 id="org81ebbd3"><span class="section-number-4">8.2.11</span> Well-known APIs</h4>
<div class="outline-text-4" id="text-8-2-11">
</div>
<div id="outline-container-orgbeb80f9" class="outline-5">
<h5 id="orgbeb80f9"><span class="section-number-5">8.2.11.1</span> Documenting with something like Swagger</h5>
</div>
</div>
<div id="outline-container-org3ae68e8" class="outline-4">
<h4 id="org3ae68e8"><span class="section-number-4">8.2.12</span> Data export/import</h4>
</div>
<div id="outline-container-org7773b5c" class="outline-4">
<h4 id="org7773b5c"><span class="section-number-4">8.2.13</span> Packaging &#x2013; how the entire project is structured</h4>
<div class="outline-text-4" id="text-8-2-13">
<p>
Maybe&#x2026; web stuff in the war, but business logic and persistence in other jars?  Yes, see
<a href="#maven">Maven</a>.
</p>
</div>
</div>

<div id="outline-container-org931e9d6" class="outline-4">
<h4 id="org931e9d6"><span class="section-number-4">8.2.14</span> Stress testing, esp. for database</h4>
<div class="outline-text-4" id="text-8-2-14">
<p>
Want to test multiple, concurrent writes.
</p>

<p>
Want to test concurrency in general.
</p>
</div>
</div>

<div id="outline-container-orga109618" class="outline-4">
<h4 id="orga109618"><span class="section-number-4">8.2.15</span> SQL profiling, tracing</h4>
<div class="outline-text-4" id="text-8-2-15">
<p>
Want to see what kinds of queries are actually created by whatever ORM system/framework I
choose.
</p>
</div>
</div>

<div id="outline-container-orgd3ba334" class="outline-4">
<h4 id="orgd3ba334"><span class="section-number-4">8.2.16</span> <span class="todo TODO">TODO</span> Object mappers (Domain/DTO)</h4>
<div class="outline-text-4" id="text-8-2-16">
<p>
Would be nice to be able to automagically transform DTOs to Domain objects and vice versa.
</p>

<p>
Consider:
</p>

<ul class="org-ul">
<li>MapStruct (<a href="https://mapstruct.org/">https://mapstruct.org/</a>)</li>
<li>modelmapper (<a href="http://modelmapper.org/">http://modelmapper.org/</a>)</li>
</ul>

<p>
See also:
</p>

<ul class="org-ul">
<li><a href="https://www.baeldung.com/entity-to-and-from-dto-for-a-java-spring-application">https://www.baeldung.com/entity-to-and-from-dto-for-a-java-spring-application</a></li>
<li><a href="https://www.baeldung.com/java-performance-mapping-frameworks">https://www.baeldung.com/java-performance-mapping-frameworks</a></li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Created: 2020-04-12 Sun 15:07</p>
<p class="creator"><a href="https://www.gnu.org/software/emacs/">Emacs</a> 26.1 (<a href="https://orgmode.org">Org</a> mode 9.2.3)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
